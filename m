Return-Path: <linux-kernel+bounces-183513-lists+linux-kernel=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from sv.mirrors.kernel.org (sv.mirrors.kernel.org [IPv6:2604:1380:45e3:2400::1])
	by mail.lfdr.de (Postfix) with ESMTPS id 991298C9A14
	for <lists+linux-kernel@lfdr.de>; Mon, 20 May 2024 11:07:10 +0200 (CEST)
Received: from smtp.subspace.kernel.org (wormhole.subspace.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by sv.mirrors.kernel.org (Postfix) with ESMTPS id 53497281914
	for <lists+linux-kernel@lfdr.de>; Mon, 20 May 2024 09:07:09 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 1E7831CA9E;
	Mon, 20 May 2024 09:07:02 +0000 (UTC)
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 934D18BEA;
	Mon, 20 May 2024 09:06:59 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=217.140.110.172
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1716196021; cv=none; b=ik6m9NdTHUszb6Fo9L46Yg+tx+Jq2rYtBUZ29mYts9ztDcAYlR5sdF99XdYKQD/QUXft6QJQkgFu8pXRbdYnrEcmvruG71S+SZ+D84XvNkqbnA1f7jnuhnH27OOqIRDXSPAKHPBxuiDZU9atIspHcrWhftTGpi0aJw8xUM7bvxQ=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1716196021; c=relaxed/simple;
	bh=f5AN/Ym0NPTwsCQk/Bh1Scol91Pp0/1dSpqgnp8kUiQ=;
	h=From:To:Cc:Subject:Date:Message-Id:MIME-Version; b=ciAjozOCgJmX83u7gS43Lr/bdvNxLRQSxbH14eqayXwIi6Jd2+BTWULbShgU0KF4OLfJIJPGiK8wNVNwA1YxRVRt2OPe26pyU5ibI69Z23p9fMLAL5pzW9cyNS2E4MciWOMNlGlj/H3MMXJ3BnnUXAssC3lRc2dKMvHVQYlXOek=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=arm.com; spf=pass smtp.mailfrom=arm.com; arc=none smtp.client-ip=217.140.110.172
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=arm.com
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=arm.com
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
	by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id DE5D0FEC;
	Mon, 20 May 2024 02:07:22 -0700 (PDT)
Received: from e132581.cambridge.arm.com (e132581.arm.com [10.2.76.71])
	by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPA id 6478D3F766;
	Mon, 20 May 2024 02:06:57 -0700 (PDT)
From: Leo Yan <leo.yan@arm.com>
To: Arnaldo Carvalho de Melo <acme@kernel.org>,
	Ian Rogers <irogers@google.com>,
	Namhyung Kim <namhyung@kernel.org>,
	James Clark <james.clark@arm.com>,
	Adrian Hunter <adrian.hunter@intel.com>,
	Athira Rajeev <atrajeev@linux.vnet.ibm.com>,
	Mark Rutland <mark.rutland@arm.com>,
	Alexander Shishkin <alexander.shishkin@linux.intel.com>,
	Jiri Olsa <jolsa@kernel.org>,
	linux-perf-users@vger.kernel.org,
	linux-kernel@vger.kernel.org
Cc: Leo Yan <leo.yan@arm.com>
Subject: [PATCH v3 0/3] perf maps: Improve the kcore maps merging
Date: Mon, 20 May 2024 10:06:44 +0100
Message-Id: <20240520090647.949371-1-leo.yan@arm.com>
X-Mailer: git-send-email 2.34.1
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Transfer-Encoding: 8bit

This patch series follows up on the patch [1] to improve the sorting and
merging of kcore maps.

Since the kcore maps are not sorted, merging them into the kernel maps
causes mess, e.g. some kcore maps might be ignored. Patch 01 sorts the
kcore maps and ensures the subset region is placed ahead of the superset
region in the list.

Patch 02 uses maps__remove_maps() to remove the identical kernel map
(generated by reading symbols from '/proc/kallsyms') from the map list.
This can give us a neat list without interfered by old map data and is a
preparation for later relying puerly on kcore maps.

Patch 03 removes the kernel text section replacement. Alternatively,
it searches the kcore maps and finds the map for kernel text section,
then update the pointer 'machine->vmlinux_map'.

This patch series is based on the latest acme's perf-tool-next branch
and tested on Arm64 Hikey960 board.

[1] https://lore.kernel.org/linux-perf-users/438f8725-ef3f-462f-90e2-840cab478ee5@arm.com/T/#m7c86a69d43103cd0cb446b0993e47c36df0f40f2


Leo Yan (3):
  perf maps: Sort kcore maps
  perf maps: Remove the kernel text map with maps__remove_maps()
  perf maps: Remove the replacement of kernel map

 tools/perf/util/maps.c   |   4 +-
 tools/perf/util/maps.h   |   2 +-
 tools/perf/util/symbol.c | 136 ++++++++++++++++++++-------------------
 3 files changed, 74 insertions(+), 68 deletions(-)

-- 
2.34.1



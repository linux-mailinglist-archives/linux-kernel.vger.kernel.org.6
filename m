Return-Path: <linux-kernel+bounces-430227-lists+linux-kernel=lfdr.de@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from ny.mirrors.kernel.org (ny.mirrors.kernel.org [IPv6:2604:1380:45d1:ec00::1])
	by mail.lfdr.de (Postfix) with ESMTPS id 0D1E89E2E1E
	for <lists+linux-kernel@lfdr.de>; Tue,  3 Dec 2024 22:32:20 +0100 (CET)
Received: from smtp.subspace.kernel.org (relay.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-ECDSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by ny.mirrors.kernel.org (Postfix) with ESMTPS id D90D11620BC
	for <lists+linux-kernel@lfdr.de>; Tue,  3 Dec 2024 21:32:16 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 671241F8930;
	Tue,  3 Dec 2024 21:32:14 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b="BQChVggg"
Received: from smtp.kernel.org (aws-us-west-2-korg-mail-1.web.codeaurora.org [10.30.226.201])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id BEC8A1885A0;
	Tue,  3 Dec 2024 21:32:13 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=10.30.226.201
ARC-Seal:i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1733261533; cv=none; b=IZy9mcxu75XZIMMWzrQq/bIl7awb9DTpCZ7DuH9TTJ/svDAqHEW42CG5Eg4SftYwhIEPn83I7ChVNTydJQhDlQA5apft2tNPwuha7HzESgkdCeI6Sfooa8nWVb7ZivzqJ+K2Atpou5ks+1zczv8BP5NXgm7PG1cyN90tdQsrGYI=
ARC-Message-Signature:i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1733261533; c=relaxed/simple;
	bh=BOg48Ob9/NVzqkpxLrxQQVqMKoA0kVXfOH8VOSVCmp0=;
	h=Date:Message-ID:From:To:Cc:Subject:In-Reply-To:References:
	 MIME-Version:Content-Type; b=iqDsZW5+WdZ/qxBIWdBLTDTLZlxGeR2rYcKQ/lum2IYZndIXxHdu8X3xVvOBDka/xOrPBVbAbtAkGiCiIL4UiFB8lkt7pvob04ip9IoBTzZY/cOeRCip7ar9G7PYj9qNS2vrMrRXTuLLUKMOSFeiYh7LHqK7wUHrwb4qrzsA6K0=
ARC-Authentication-Results:i=1; smtp.subspace.kernel.org; dkim=pass (2048-bit key) header.d=kernel.org header.i=@kernel.org header.b=BQChVggg; arc=none smtp.client-ip=10.30.226.201
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 498E7C4CED8;
	Tue,  3 Dec 2024 21:32:13 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
	s=k20201202; t=1733261533;
	bh=BOg48Ob9/NVzqkpxLrxQQVqMKoA0kVXfOH8VOSVCmp0=;
	h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
	b=BQChVgggT/bBeKHZ8u8dvoyJoHoBlz9+KD0dYqf7fyD45vOJGfMo0S7WkoUP8Vl8W
	 ziJNnSxLXVJr/YwOo9BOglDutV4ejT1qz/qCrjysPT8FVGB0njHXQhhtUYqqeQV97a
	 YX11HDV2c3KepOLCh5LoNsW7yCk/TZ15gxW/5oSZA/ZhSlhz/Va04JD2xEP1vYZHWI
	 +3hv13473VvVtkKiuBdK8C8Afo167/LLjFPjfgfoGeD297Jc7mNlOn+H6btyGm4D9j
	 9JSxRiQPjgv92f7BZlzDKxyYk3QGZtYgrxJ7kGToFqQKaJVH9zGTsPrcmBXt7WJ0rU
	 emXujeUxfEE5Q==
Received: from sofa.misterjones.org ([185.219.108.64] helo=wait-a-minute.misterjones.org)
	by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
	(Exim 4.95)
	(envelope-from <maz@kernel.org>)
	id 1tIaV8-000EuJ-Rd;
	Tue, 03 Dec 2024 21:32:10 +0000
Date: Tue, 03 Dec 2024 21:32:10 +0000
Message-ID: <87ldwwsbad.wl-maz@kernel.org>
From: Marc Zyngier <maz@kernel.org>
To: Oliver Upton <oliver.upton@linux.dev>
Cc: kvmarm@lists.linux.dev,
	Joey Gouly <joey.gouly@arm.com>,
	Suzuki K Poulose <suzuki.poulose@arm.com>,
	Zenghui Yu <yuzenghui@huawei.com>,
	Mingwei Zhang <mizhang@google.com>,
	Colton Lewis <coltonlewis@google.com>,
	Raghavendra Rao Ananta <rananta@google.com>,
	Catalin Marinas <catalin.marinas@arm.com>,
	Will Deacon <will@kernel.org>,
	Mark Rutland <mark.rutland@arm.com>,
	linux-arm-kernel@lists.infradead.org,
	linux-kernel@vger.kernel.org
Subject: Re: [RFC PATCH 05/14] KVM: arm64: Always allow fixed cycle counter
In-Reply-To: <20241203193220.1070811-6-oliver.upton@linux.dev>
References: <20241203193220.1070811-1-oliver.upton@linux.dev>
	<20241203193220.1070811-6-oliver.upton@linux.dev>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/29.4
 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: oliver.upton@linux.dev, kvmarm@lists.linux.dev, joey.gouly@arm.com, suzuki.poulose@arm.com, yuzenghui@huawei.com, mizhang@google.com, coltonlewis@google.com, rananta@google.com, catalin.marinas@arm.com, will@kernel.org, mark.rutland@arm.com, linux-arm-kernel@lists.infradead.org, linux-kernel@vger.kernel.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false

On Tue, 03 Dec 2024 19:32:11 +0000,
Oliver Upton <oliver.upton@linux.dev> wrote:
> 
> The fixed CPU cycle counter is mandatory for PMUv3, so it doesn't make a
> lot of sense allowing userspace to filter it. Only apply the PMU event
> filter to *programmed* event counters.

But that's a change in ABI, isn't it? We explicitly say in the
documentation that the cycle counter can be filtered by specifying
event 0x11.

More importantly, the current filtering works in terms of events, and
not in terms of counters.

Instead of changing the ABI, how about simply not supporting filtering
on such non-compliant HW? Surely that would simplify a few things.

Thanks,

	M.

-- 
Without deviation from the norm, progress is not possible.

